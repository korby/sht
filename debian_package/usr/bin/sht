#!/bin/bash
path=`pwd`
confFile=$HOME/sht/sht

function getRemoteConChain {
  idConn=$1
  confLine=`cat $confFile | grep $idConn:`;
  echo $confLine | cut -d":" -f2
}
function copyId {
  shCmd=`getRemoteConChain $1`
  ssh-copy-id $shCmd
}
function loadCmd {
  shCmd=`getRemoteConChain $1`
  ssh $shCmd ${@:2};
}
function execCmd {
  shCmd=`getRemoteConChain $1`
  ssh $shCmd "${@:3}"
}
function addCmd {
    if test -z "$1"
        then
             echo "first argument (shortcut's name) missing";
             exit 1;
    fi
    if test -z "$2"
        then
             echo "second argument (shortcut's command) missing";
             exit 1;
        else
             if [[ "$2" =~ "@" ]] ; then
                 if grep $1":" $confFile > /dev/null
                    then
                    echo "Shortcut $1 already exists";
                    exit 1;
                 else
                    echo $1":"$2" "$3" "$4 >> $confFile;
                    echo $1" added to the shortcuts' file";
                 fi
             else
                 echo "second argument (shortcut's command) is incorrect";
             fi
    fi

}
function displayCmd {
  cat $confFile | grep $1;
}

while getopts clhfide: opt
do
    case "$opt" in
      l)  cat $confFile | sort -k1n,1n; exit 1; ;;
      c)  addCmd $2 $3 $4 $5; exit 1; ;;
      e)  execCmd $2 ${@:2}; exit 1; ;;
      i)  copyId $2; loadCmd $2; exit 1; ;;
      d)  displayCmd $2; exit 1; ;;
      h)  echo "usage: -h | -c | -l | -i" ;
          echo "usage: $0 [shortcut to launch] : before you have to fill/create you shortcuts file here: "$confFile" With this syntax for each line : shortcutsName:sshuser@sshhost" ;
          echo "usage: $0 -d [term to search] : display shortcuts matching with term" ;
          echo "usage: $0 -c [name] [user@host] : add the shortcut in the shortcuts' file" ;
          echo "usage: $0 -i [shortcut to launch] : launch the shortcut and ssh copy id" ;
          echo "usage: $0 -e [shortcut to launch] [bash command] : execute bash command on remote host" ;
          echo " -h : print help" ;
          exit 1; ;;
      \?)   # unknown flag
          echo >&2 \
    "usage: $0 shortcut to launch, before you have to fill/create you shortcuts file here: "$confFile" With this syntax for each line : shortcutsName:sshuser@sshhost"
    exit 1;;
    esac
done

if test -z "$*"
then
     cat $confFile | sort -k1n,1n;
else
     loadCmd $1 ${@:2}
fi
